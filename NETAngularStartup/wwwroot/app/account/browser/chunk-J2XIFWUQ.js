import{a as xe,d as be,f as Me,h as Ie,k as Te,m as we,n as Oe,o as Se}from"./chunk-UC2T4NGG.js";import{a as ye}from"./chunk-QWIGCCEX.js";import{a as he}from"./chunk-LPJ56NT7.js";import{a as fe}from"./chunk-6NY67VQD.js";import{a as ve,c as Ce}from"./chunk-IPHKMWFL.js";import{d as F,e as V,f as B}from"./chunk-NNQMNV6J.js";import{A as me,B as ge,C as O,E as N,G as ue,M as R,g as ne,m as M,t as A,v as ae,w as pe,z as _e}from"./chunk-IQZ6UM2A.js";import{$ as _,Ba as s,Bb as h,Cb as y,Eb as q,Ec as de,Ha as G,La as p,Oa as l,Ob as K,Pb as X,Qb as Z,Rb as ee,T as k,Ub as te,Vb as ie,X as $,Xa as d,Ya as c,Za as b,ab as z,bb as f,db as u,eb as a,ha as m,hc as oe,ia as g,ib as Q,jc as re,ob as Y,pb as C,pc as se,rb as w,sb as J,sc as le,tb as j,ub as H,vb as W,wb as L,wc as ce,xb as P}from"./chunk-EURR6JOP.js";import{a as v,b as E}from"./chunk-WWX6BADO.js";var I=class i{config=_(ae);coreService=_(O);constructor(){}generateControls(t,e){let o=[],n=!1,r=!0;t.id>0&&(n=!0,r=!1);let x=300,S=300;if(e.length>0){let T=e[0].configs.settings.category;x=T.thumbWidth,S=T.thumbHeight}let D={cropped_picture:t.avatar,croptype:1,upload_id:"category_avatar",colcss:"col-lg-2 col-md-4",settings:{width:x,height:S},uploadbtntext:"Upload Avatar",btncss:"btn btn-outline-success px-5 radius-30"};o.push(new _e({key:"avatar",label:"",value:t.avatar,required:!1,cropperOptions:D,helpblock:"Cropsize: "+D.settings.width+"x"+D.settings.height,order:0}));let ke=t.category_data.title;o.push(new pe({key:"title",label:"Slug",placeholder:"Enter term to generate slug",value:ke,required:!0,minLength:3,maxLength:150,order:1,labelGenerator:r,helpblock:""})),o.push(new me({key:"term",value:t.term,options:[{rawText:"",slug:t.term,isupdate:n,type:5}],isVisible:!0,order:2}));let U={type:0,cultures:[],data:t.culture_categories};return e.length>0&&(U.cultures=e[0].configs.cultures),o.push(new ge({key:"culture_categories",categoryOptions:JSON.parse(JSON.stringify(U)),tinymiceOptions:this.coreService.prepareInitEditorSettings(),required:!1,order:5,helpblock:""})),o.sort((T,Le)=>T.order-Le.order)}static \u0275fac=function(e){return new(e||i)};static \u0275prov=$({token:i,factory:i.\u0275fac})};var De=()=>[],Ae=i=>({list:i}),Ne=i=>({selected:i});function Re(i,t){i&1&&(d(0,"div"),b(1,"app-norecord",2),c()),i&2&&(s(),l("message","Access Restricted"))}function Fe(i,t){i&1&&b(0,"app-loader")}function Ve(i,t){if(i&1){let e=f();d(0,"button",4),u("click",function(n){m(e);let r=a(4);return g(r.deleteRecord(r.selectedDocument,n))}),C(1," Delete "),c()}}function Be(i,t){if(i&1){let e=f();d(0,"div",10)(1,"a",20),u("click",function(n){return m(e),a(4).navigateBack(n),g(!1)}),b(2,"i",21),C(3," Back "),c()()}}function Ue(i,t){i&1&&z(0)}function $e(i,t){if(i&1&&(d(0,"div",22)(1,"ul"),p(2,Ue,1,0,"ng-container",23),h(3,"async"),c()()),i&2){a();let e=Y(21),o=a(3);s(2),l("ngTemplateOutlet",e)("ngTemplateOutletContext",P(4,Ae,y(3,2,o.filteredNavList$)))}}function Ge(i,t){if(i&1&&(d(0,"div",24)(1,"p"),C(2),c()()),i&2){let e=a(4);s(2),w("No ",e.labels," found!")}}function ze(i,t){if(i&1){let e=f();d(0,"i",29),u("click",function(n){m(e);let r=a().$implicit;return a(5).toggleMenuItems(r,n),g(!1)}),c()}}function Qe(i,t){if(i&1){let e=f();d(0,"li")(1,"a",26),u("click",function(n){let r=m(e).$implicit,x=a().list;return a(4).selectItem(x,r,n),g(!1)}),p(2,ze,1,0,"i",27),d(3,"span",28),C(4),c()()()}if(i&2){let e=t.$implicit,o=a(5);s(),l("ngClass",P(3,Ne,e.id===o.selectedDocument.id)),s(),l("ngIf",!e.isnew),s(2),w(" ",e.category_data.title,"")}}function Ye(i,t){if(i&1&&p(0,Qe,5,5,"li",25),i&2){let e=t.list,o=a(4);l("ngForOf",e)("ngForTrackBy",o.getKey)}}function Je(i,t){i&1&&b(0,"app-loader")}function je(i,t){if(i&1){let e=f();d(0,"div")(1,"dynamic-modal-form",30),u("OnSubmit",function(n){m(e);let r=a(5);return g(r.submitForm(n))}),c()()}if(i&2){let e=a(5);s(),l("controls",e.controls)("showLoader",e.showLoader)("showCancel",!1)("showModal",!1)("submitText",e.submitButtonText)}}function He(i,t){if(i&1&&(d(0,"div",8)(1,"div",9),p(2,Je,1,0,"app-loader",1)(3,je,2,5,"div",1),c()()),i&2){let e=a(4);s(2),l("ngIf",e.showLoader),s(),l("ngIf",!e.showLoader)}}function We(i,t){if(i&1){let e=f();d(0,"div")(1,"div",3)(2,"button",4),u("click",function(n){m(e);let r=a(3);return g(r.back(n))}),C(3," Back to Listing "),c(),p(4,Ve,2,0,"button",5),c(),d(5,"div",6)(6,"div",7)(7,"div",8)(8,"div",9)(9,"div",10)(10,"a",11),u("click",function(n){return m(e),a(3).addDocument(n),g(!1)}),C(11),c()(),d(12,"div",12)(13,"input",13),H("ngModelChange",function(n){m(e);let r=a(3);return j(r.searchTerm,n)||(r.searchTerm=n),g(n)}),u("input",function(n){m(e);let r=a(3);return g(r.fllterCategories(n))}),c()(),p(14,Be,4,0,"div",14),d(15,"div",15),p(16,$e,4,6,"div",16),h(17,"async"),p(18,Ge,3,1,"div",17),h(19,"async"),c(),p(20,Ye,1,2,"ng-template",null,0,q),c()()(),d(22,"div",18),p(23,He,4,2,"div",19),c()()()}if(i&2){let e,o,n=a(3);s(4),l("ngIf",n.selectedDocument.id>0),s(7),w("Add ",n.label,""),s(2),Q("placeholder","Filter ",n.labels,"..."),J("ngModel",n.searchTerm),s(),l("ngIf",n.parentIds.length>0),s(2),l("ngIf",((e=y(17,9,n.filteredNavList$))!==null&&e!==void 0?e:L(13,De)).length>0),s(2),l("ngIf",((o=y(19,11,n.filteredNavList$))!==null&&o!==void 0?o:L(14,De)).length===0),s(5),l("ngIf",n.controls.length>0)}}function qe(i,t){if(i&1&&(d(0,"div"),p(1,Fe,1,0,"app-loader",1),h(2,"async"),p(3,We,24,15,"div",1),h(4,"async"),c()),i&2){let e=a(2);s(),l("ngIf",y(2,2,e.loading$)),s(2),l("ngIf",!y(4,4,e.loading$))}}function Ke(i,t){if(i&1&&(d(0,"div"),p(1,Re,2,1,"div",1)(2,qe,5,6,"div",1),c()),i&2){let e=a();s(),l("ngIf",!e.pageRole.admin),s(),l("ngIf",e.pageRole.admin)}}var Ee=class i{store=_(ne);formService=_(I);categoryService=_(B);coreService=_(O);router=_(re);route=_(oe);location=_(K);modalService=_(Ce);Type=0;showLoader=!1;isAuthenticated=!1;searchTerm="";LABEL_MAP={7:{singular:"Document",plural:"Documents"},default:{singular:"Category",plural:"Categories"}};label="";labels="";parentIds=[];parentID=0;submitButtonText="Save Changes";controls=[];auth$=this.store.select(A);config$=this.store.select(R);loading$=this.store.select(we);filteredNavList$=this.getChildren(this.parentID);User=v({},N);pageRole=ue;configs=[];navQuery=v({},F);selectedDocument=v({},V);ngOnInit(){this.initializeAuthSubscription()}ngOnDestroy(){}initializeAuthSubscription(){this.auth$=this.store.select(A).pipe(k(t=>{t.length>0&&(this.isAuthenticated=t[0].isAuthenticated,this.User=t[0].User||v({},N),this.pageRole=this.coreService.processRole(t[0].Role||[]),this.loadAppConfigs())})),this.auth$.subscribe()}loadAppConfigs(){this.config$=this.store.select(R).pipe(k(t=>{t.length>0&&(this.configs=t,this.initializeCategoryData())})),this.config$.subscribe()}initializeCategoryData(){this.route.params.subscribe(t=>{this.coreService.bindParams(this.navQuery,t),this.Type>0&&(this.navQuery.type=this.Type),Number(this.navQuery.type)!==0&&(this.navQuery.loadall=!0,this.store.dispatch(xe({Query:this.navQuery}))),this.initializeLabel(this.navQuery.type)})}initializeLabel(t){let e=this.LABEL_MAP[t]||this.LABEL_MAP.default;this.label=e.singular,this.labels=e.plural}initializeDocument(t){return E(v({},V),{type:this.navQuery.type,parentid:t})}initializeControls(){this.controls=this.formService.generateControls(this.selectedDocument,this.configs)}addDocument(t){this.selectedDocument=this.initializeDocument(this.parentID),this.selectedDocument.culture_categories=[],this.submitButtonText="Add Category",this.initializeControls(),t.stopPropagation()}navigateBack(t){if(t.stopPropagation(),this.parentIds.length===0)return;this.controls=[];let e=[...this.parentIds],o=e.pop();o!=null&&(this.parentID=o,this.parentIds=e,this.filteredNavList$=this.getChildren(this.parentID))}toggleMenuItems(t,e){e.stopPropagation(),e.preventDefault(),this.controls=[],this.parentIds.push(t.parentid),this.parentID=t.id,this.filteredNavList$=this.getChildren(t.id)}selectItem(t,e,o){this.selectedDocument=e,this.store.dispatch(Te({id:e.id})),this.loadDocument(this.selectedDocument.id),o.stopPropagation()}loadDocument(t){this.showLoader=!0,this.categoryService.GetInfo(E(v({},F),{id:t})).pipe().subscribe(e=>{e.status==="error"?this.store.dispatch(M({title:e.message??"Unknown error",text:"",css:"bg-danger"})):(e.record&&(this.selectedDocument=e.record,this.initializeControls()),this.showLoader=!1)})}fllterCategories(t){this.filteredNavList$=this.searchByTerm(this.searchTerm)}deleteRecord(t,e){this.openConfirmationDialog("Delete Record","Are you sure you want to delete selected record",()=>{this.controls=[],this.store.dispatch(Ie({Entities:[t],actionstatus:"delete"}))},e)}openConfirmationDialog(t,e,o,n){n.stopPropagation();let r=this.modalService.open(ye,{backdrop:!1});r.componentInstance.Info={title:t,message:e},r.result.then(()=>o(),()=>console.log("Dialog dismissed"))}submitForm(t){let e=t.culture_categories;if(t.culture_categories===void 0||e===null||e.length===0){this.store.dispatch(M({title:"Please add one or more culture",text:"",css:"bg-danger"}));return}for(let n in t)this.selectedDocument[n]=t[n];this.selectedDocument.category_data={id:0,categoryid:this.selectedDocument.id,culture:"en",title:t.title,sub_title:"",description:""};let o=JSON.parse(JSON.stringify(this.selectedDocument));this.showLoader=!0,this.categoryService.ProcessRecord(o).pipe().subscribe(n=>{if(n.status==="error")this.store.dispatch(M({title:n.message??"Unknown error",text:"",css:"bg-danger"}));else{let r="updated";this.selectedDocument.id===0&&(r="added"),n.record&&(this.selectedDocument.id===0?(this.selectedDocument.id=n.record.id,this.store.dispatch(be({category:o}))):this.store.dispatch(Me({category:o}))),this.store.dispatch(M({title:"Record "+r+" successfully!",text:"",css:"bg-success"})),this.showLoader=!1}})}getChildren(t){return this.store.select(Oe(t))}searchByTerm(t){return this.store.select(Se(t))}back(t){t.stopPropagation(),this.location.back()}getKey(t,e){return e.id.toString()}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=G({type:i,selectors:[["app-main-category"]],inputs:{Type:"Type"},features:[W([I,B])],decls:1,vars:1,consts:[["recursiveListTemplate",""],[4,"ngIf"],[3,"message"],[1,"d-flex","justify-content-between","mb-3"],[1,"btn","btn-secondary","me-1",3,"click"],["class","btn btn-secondary me-1",3,"click",4,"ngIf"],[1,"row"],[1,"col-md-3"],[1,"card","font-16"],[1,"card-body"],[1,"d-grid","mb-3"],["href","#",1,"btn","btn-primary",3,"click"],[1,"mb-3"],["type","text",1,"form-control",3,"ngModelChange","input","ngModel","placeholder"],["class","d-grid mb-3",4,"ngIf"],[1,"catmenu-container"],["class","catmenu",4,"ngIf"],["class","text-center mt-4 mb-4",4,"ngIf"],[1,"col-md-9"],["class","card font-16",4,"ngIf"],["href","#",1,"btn","btn-dark",3,"click"],[1,"bx","bx-chevron-left"],[1,"catmenu"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"text-center","mt-4","mb-4"],[4,"ngFor","ngForOf","ngForTrackBy"],["href","#",1,"d-flex",3,"click","ngClass"],["class","bx bx-chevron-right me-1 bxicon",3,"click",4,"ngIf"],[1,"category-item"],[1,"bx","bx-chevron-right","me-1","bxicon",3,"click"],[3,"OnSubmit","controls","showLoader","showCancel","showModal","submitText"]],template:function(e,o){e&1&&p(0,Ke,3,2,"div",1),e&2&&l("ngIf",o.isAuthenticated)},dependencies:[ee,Z,X,te,de,se,le,ce,ie,ve,fe,he],styles:[".catmenu-container[_ngcontent-%COMP%]{overflow-x:auto;overflow-y:auto;height:500px}.catmenu[_ngcontent-%COMP%]{padding:0}.catmenu[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0}.catmenu[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none;margin:3px 0;padding:7px 5px}.catmenu[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%] > ul[_ngcontent-%COMP%]{margin-left:15px}.catmenu[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{background-color:#8eafed;color:#fff}.category-item[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;display:block;text-overflow:ellipsis}.bxicon[_ngcontent-%COMP%]:hover{background-color:#fff;color:#000}.selected[_ngcontent-%COMP%]{background-color:#8eafed;color:#fff}"]})};export{Ee as a};
