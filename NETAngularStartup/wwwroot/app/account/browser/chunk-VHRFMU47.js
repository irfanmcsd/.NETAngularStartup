import{a as b}from"./chunk-GTTQKVCF.js";import{a as U}from"./chunk-6FSCV3TH.js";import{a as X}from"./chunk-LPJ56NT7.js";import{a as K}from"./chunk-6NY67VQD.js";import{a as J}from"./chunk-IPHKMWFL.js";import"./chunk-NNQMNV6J.js";import{C as B,D as _,E as v,G as H,M as Y,g as $,m as z,t as G,v as Q}from"./chunk-IQZ6UM2A.js";import{$ as s,Ba as o,Ec as h,Fc as V,Ha as w,Ia as P,La as p,Oa as r,Ob as A,Rb as E,S as c,T as g,Xa as a,Xb as O,Y as x,Ya as n,Za as m,bb as D,c as S,db as M,eb as d,fc as L,ha as I,hc as k,ia as R,jc as j,mc as f,pb as N,qb as T,vb as F}from"./chunk-EURR6JOP.js";import{a as l,b as C}from"./chunk-WWX6BADO.js";function te(i,e){i&1&&(a(0,"div"),m(1,"app-norecord",1),n()),i&2&&(o(),r("message","Access Restricted"))}function ie(i,e){i&1&&m(0,"app-loader")}function oe(i,e){if(i&1){let t=D();a(0,"div")(1,"dynamic-modal-form",4),M("OnSubmit",function(W){I(t);let Z=d(4);return R(Z.submitForm(W))}),n()()}if(i&2){let t=d(4);o(),r("controls",t.controls)("showLoader",t.showLoader)("showCancel",!1)("showModal",!1)("submitText",t.submitButtonText)}}function re(i,e){if(i&1&&(a(0,"div")(1,"div",2)(2,"h5",3),N(3),n(),m(4,"hr"),p(5,ie,1,0,"app-loader",0)(6,oe,2,5,"div",0),n()()),i&2){let t=d(3);o(3),T(t.headingTitle),o(2),r("ngIf",t.showLoader),o(),r("ngIf",!t.showLoader)}}function se(i,e){if(i&1&&(a(0,"div"),m(1,"app-norecord",1),n()),i&2){let t=d(3);o(),r("message",t.errorMessage)}}function ne(i,e){if(i&1&&(a(0,"div"),p(1,re,7,3,"div",0)(2,se,2,1,"div",0),n()),i&2){let t=d(2);o(),r("ngIf",t.errorMessage===""),o(),r("ngIf",t.errorMessage!=="")}}function ae(i,e){if(i&1&&(a(0,"div"),p(1,te,2,1,"div",0)(2,ne,3,2,"div",0),n()),i&2){let t=d();o(),r("ngIf",!t.pageRole.user),o(),r("ngIf",t.pageRole.user&&t.pageInit)}}var u=class i{store=s($);formService=s(b);userService=s(U);route=s(k);router=s(j);coreService=s(B);titleService=s(L);appConfig=s(Q);location=s(A);auth$=this.store.select(G);config$=this.store.select(Y);navQuery=l({},_);isAuthenticated=!1;User=l({},v);selectedDocument=l({},v);configs=[];pageRole=H;ProfileView=0;pageIndex="_INDEX_";errorMessage="";pageInit=!1;showLoader=!1;submitButtonText="Save Changes";headingTitle="User Profile";controls=[];destroy$=new S;ngOnInit(){this.initializeAuthSubscription()}initializeAuthSubscription(){this.auth$.pipe(c(this.destroy$),g(e=>{e.length>0&&e[0].isAuthenticated&&(this.isAuthenticated=!0,this.User=e[0].User??l({},v),this.pageRole=this.coreService.processRole(e[0].Role||[]),this.loadAppConfigs())})).subscribe()}loadAppConfigs(){this.config$.pipe(c(this.destroy$),g(e=>{e.length>0&&(this.configs=e,this.navQuery.pagesize=this.configs[0].configs.settings.general.pageSize,this.initializeRouteListener())})).subscribe()}initializeRouteListener(){this.route.params.pipe(c(this.destroy$)).subscribe(e=>{this.coreService.bindParams(this.navQuery,e),this.initializeRouteData()})}initializeRouteData(){let e=this.route.snapshot.firstChild?.data||this.route.snapshot.data;e.key&&(this.pageIndex=e.key),e.title&&this.titleService.setTitle(`${e.title} - ${this.appConfig.getConfig("title")}`),this.initializePage(),this.pageInit=!0}initializePage(){this.initializeCreateUpdate()}initializeCreateUpdate(){console.log("userid : ",this.User.id),this.headingTitle="User Profile",this.User.id?this.loadDocument(this.User.id):this.errorMessage="Invalid record ID"}loadDocument(e){this.showLoader=!0,this.userService.GetInfo(C(l({},_),{id:e})).pipe(c(this.destroy$)).subscribe({next:t=>{t.status==="error"?this.showNotification(t.message??"Unknown error","danger"):t.record&&this.handleDocumentResponse(t.record),this.showLoader=!1},error:t=>{this.showNotification("Failed to load document","danger"),this.showLoader=!1}})}handleDocumentResponse(e){this.selectedDocument=e,this.initializeUpdateControls()}initializeUpdateControls(){this.controls=this.formService.UpdateUserProfile(this.selectedDocument,this.configs)}submitForm(e){this.validateForm(e)&&(this.prepareDocumentForSubmission(e),this.processUserSubmission())}validateForm(e){return!0}prepareDocumentForSubmission(e){Object.assign(this.selectedDocument,e)}processUserSubmission(){this.showLoader=!0,this.userService.ProcessRecord(this.selectedDocument).pipe(c(this.destroy$)).subscribe({next:e=>{e.status==="error"?this.showNotification(e.message??"Unknown error","danger"):this.handleSuccessfulSubmission(e),this.showLoader=!1},error:e=>{this.showNotification("Failed to submit blog","danger"),this.showLoader=!1}})}handleSuccessfulSubmission(e){let t=this.selectedDocument.id===""?"added":"updated";e.record&&(this.selectedDocument=e.record),this.showNotification(`Profile ${t} successfully!`,"success")}showNotification(e,t){this.store.dispatch(z({title:e,text:"",css:`bg-${t}`}))}back(e){e.stopPropagation(),this.location.back()}getKey(e,t){return t.id}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=w({type:i,selectors:[["ng-component"]],features:[F([b,U])],decls:1,vars:1,consts:[[4,"ngIf"],[3,"message"],[1,"card-body","p-4"],[1,"card-title"],[3,"OnSubmit","controls","showLoader","showCancel","showModal","submitText"]],template:function(t,y){t&1&&p(0,ae,3,2,"div",0),t&2&&r("ngIf",y.isAuthenticated)},dependencies:[E,f,h,K,X,J],encapsulation:2})};var de=[{path:"",data:{key:"_UPDATE_",title:"User Profile",breadcrumb:[]},component:u}],q=class i{static \u0275fac=function(t){return new(t||i)};static \u0275mod=P({type:i});static \u0275inj=x({imports:[O,h,V,f,f.forChild(de),u]})};export{q as MainUserProfileModule};
