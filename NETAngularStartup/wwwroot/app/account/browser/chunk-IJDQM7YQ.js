import{a as C}from"./chunk-GTTQKVCF.js";import{a as b}from"./chunk-6FSCV3TH.js";import{a as X}from"./chunk-LPJ56NT7.js";import{a as K}from"./chunk-6NY67VQD.js";import{a as J}from"./chunk-IPHKMWFL.js";import"./chunk-NNQMNV6J.js";import{C as B,D as _,E as v,G as H,M as Y,g as z,m as P,t as G,v as Q}from"./chunk-IQZ6UM2A.js";import{$ as n,Ba as o,Ec as f,Fc as V,Ha as w,Ia as R,La as l,Oa as r,Ob as N,Rb as O,S as p,T as g,Xa as a,Xb as L,Y as U,Ya as s,Za as m,bb as A,c as x,db as D,eb as d,fc as $,ha as I,hc as k,ia as M,jc as j,mc as u,pb as T,qb as F,vb as E}from"./chunk-EURR6JOP.js";import{a as c,b as S}from"./chunk-WWX6BADO.js";function te(i,e){i&1&&(a(0,"div"),m(1,"app-norecord",1),s()),i&2&&(o(),r("message","Access Restricted"))}function ie(i,e){i&1&&m(0,"app-loader")}function oe(i,e){if(i&1){let t=A();a(0,"div")(1,"dynamic-modal-form",4),D("OnSubmit",function(W){I(t);let Z=d(4);return M(Z.submitForm(W))}),s()()}if(i&2){let t=d(4);o(),r("controls",t.controls)("showLoader",t.showLoader)("showCancel",!1)("showModal",!1)("submitText",t.submitButtonText)}}function re(i,e){if(i&1&&(a(0,"div")(1,"div",2)(2,"h5",3),T(3),s(),m(4,"hr"),l(5,ie,1,0,"app-loader",0)(6,oe,2,5,"div",0),s()()),i&2){let t=d(3);o(3),F(t.headingTitle),o(2),r("ngIf",t.showLoader),o(),r("ngIf",!t.showLoader)}}function ne(i,e){if(i&1&&(a(0,"div"),m(1,"app-norecord",1),s()),i&2){let t=d(3);o(),r("message",t.errorMessage)}}function se(i,e){if(i&1&&(a(0,"div"),l(1,re,7,3,"div",0)(2,ne,2,1,"div",0),s()),i&2){let t=d(2);o(),r("ngIf",t.errorMessage===""),o(),r("ngIf",t.errorMessage!=="")}}function ae(i,e){if(i&1&&(a(0,"div"),l(1,te,2,1,"div",0)(2,se,3,2,"div",0),s()),i&2){let t=d();o(),r("ngIf",!t.pageRole.user),o(),r("ngIf",t.pageRole.user&&t.pageInit)}}var h=class i{store=n(z);formService=n(C);userService=n(b);route=n(k);router=n(j);coreService=n(B);titleService=n($);appConfig=n(Q);location=n(N);auth$=this.store.select(G);config$=this.store.select(Y);navQuery=c({},_);isAuthenticated=!1;User=c({},v);selectedDocument=c({},v);configs=[];pageRole=H;ProfileView=0;pageIndex="_INDEX_";errorMessage="";pageInit=!1;showLoader=!1;submitButtonText="Save Changes";headingTitle="Change Password";controls=[];destroy$=new x;ngOnInit(){this.initializeAuthSubscription()}initializeAuthSubscription(){this.auth$.pipe(p(this.destroy$),g(e=>{e.length>0&&e[0].isAuthenticated&&(this.isAuthenticated=!0,this.User=e[0].User??c({},v),this.pageRole=this.coreService.processRole(e[0].Role||[]),this.loadAppConfigs())})).subscribe()}loadAppConfigs(){this.config$.pipe(p(this.destroy$),g(e=>{e.length>0&&(this.configs=e,this.navQuery.pagesize=this.configs[0].configs.settings.general.pageSize,this.initializeRouteListener())})).subscribe()}initializeRouteListener(){this.route.params.pipe(p(this.destroy$)).subscribe(e=>{this.coreService.bindParams(this.navQuery,e),this.initializeRouteData()})}initializeRouteData(){let e=this.route.snapshot.firstChild?.data||this.route.snapshot.data;e.key&&(this.pageIndex=e.key),e.title&&this.titleService.setTitle(`${e.title} - ${this.appConfig.getConfig("title")}`),this.initializePage(),this.pageInit=!0}initializePage(){this.initializeCreateUpdate()}initializeCreateUpdate(){this.headingTitle="Change Password",this.User.id?this.loadDocument(this.User.id):this.errorMessage="Invalid record ID"}loadDocument(e){this.showLoader=!0,this.userService.GetInfo(S(c({},_),{id:e})).pipe(p(this.destroy$)).subscribe({next:t=>{t.status==="error"?this.showNotification(t.message??"Unknown error","danger"):t.record&&this.handleDocumentResponse(t.record),this.showLoader=!1},error:t=>{this.showNotification("Failed to load document","danger"),this.showLoader=!1}})}handleDocumentResponse(e){this.selectedDocument=e,this.initializeUpdateControls()}initializeUpdateControls(){this.controls=this.formService.ChangeUserPasswordControls(this.selectedDocument,this.configs)}submitForm(e){this.validateForm(e)&&(this.prepareDocumentForSubmission(e),this.processUserSubmission())}validateForm(e){return!0}prepareDocumentForSubmission(e){Object.assign(this.selectedDocument,e)}processUserSubmission(){this.showLoader=!0,this.userService.ChangePassword(this.selectedDocument).pipe(p(this.destroy$)).subscribe({next:e=>{e.status==="error"?this.showNotification(e.message??"Unknown error","danger"):this.handleSuccessfulSubmission(e),this.showLoader=!1},error:e=>{this.showNotification("Failed to submit blog","danger"),this.showLoader=!1}})}handleSuccessfulSubmission(e){let t=this.selectedDocument.id===""?"added":"updated";e.record&&(this.selectedDocument=e.record),this.showNotification(`Password ${t} successfully!`,"success")}showNotification(e,t){this.store.dispatch(P({title:e,text:"",css:`bg-${t}`}))}back(e){e.stopPropagation(),this.location.back()}getKey(e,t){return t.id}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=w({type:i,selectors:[["ng-component"]],features:[E([C,b])],decls:1,vars:1,consts:[[4,"ngIf"],[3,"message"],[1,"card-body","p-4"],[1,"card-title"],[3,"OnSubmit","controls","showLoader","showCancel","showModal","submitText"]],template:function(t,y){t&1&&l(0,ae,3,2,"div",0),t&2&&r("ngIf",y.isAuthenticated)},dependencies:[O,u,f,K,X,J],encapsulation:2})};var de=[{path:"",data:{key:"_UPDATE_",title:"Manage Account",breadcrumb:[]},component:h}],q=class i{static \u0275fac=function(t){return new(t||i)};static \u0275mod=R({type:i});static \u0275inj=U({imports:[L,f,V,u,u.forChild(de),h]})};export{q as MainAccountModule};
